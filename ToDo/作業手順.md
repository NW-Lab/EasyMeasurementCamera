# 作業手順

このドキュメントは EasyShareCamera プロジェクトの開発作業手順をまとめたものです。
プロジェクト全体の進行管理、実装の優先順位、各フェーズでの作業内容を整理しています。

---

## プロジェクト概要

### 目的
- 様々な物理現象を撮影するカメラアプリを作成
- 教育用として同じ物理現象を受講者にもカメラで撮影してもらう
- Master カメラの設定・操作が Remote カメラに同期される仕組み

### 技術仕様
- **対象デバイス**: iPhone、iPad
- **最小対応バージョン**: iOS 17.0+
- **UI フレームワーク**: SwiftUI
- **カメラ制御**: AVFoundation
- **デバイス間通信**: MultipeerConnectivity
- **画像共有**: 不要（標準写真アプリに委譲）

---

## 開発フェーズ

### Phase 1: MVP (最小機能製品)

#### 優先実装機能
1. **Apple標準カメラUI風のインターフェース**
   - SwiftUI ベースの UI 構築
   - iOS 17 の最新カメラコントロール活用
   - 直感的な操作性

2. **高速撮影（スローモーション）サポート**
   - 240fps@1080p 対応
   - Master の設定を Remote に同期
   - デバイス依存機能の適切な処理

3. **デバイス探索・ペアリング機能**
   - MultipeerConnectivity による自動検出
   - Master/Remote 役割設定
   - 接続状態の可視化


4. **Master → Remote の設定同期**
   - ISO感度、露出時間、フォーカス位置、ホワイトバランス
   - 解像度、フレームレート
   - リアルタイム同期

5. **同時シャッター／同時録画トリガ**
   - Master のシャッター操作を Remote へ伝播
   - 遅延最小化（最優先要件）
   - タイムスタンプ同期



#### Phase 1 の作業手順

1. **プロジェクトセットアップ**
   - Xcode プロジェクト作成（iOS 17.0 minimum target）
   - 必要な Framework の追加（AVFoundation, MultipeerConnectivity）
   - SwiftUI ベースの基本構造構築

2. **カメラ基本機能実装**
   - AVCaptureSession の基本セットアップ
   - SwiftUI での カメラプレビュー表示
   - 基本的な撮影機能（写真・動画）
   - 高速撮影（スローモーション）機能の実装

3. **UI/UX 整備**
   - Apple 標準カメラ風 UI の実装
   - カメラコントロール（ISO、露出時間、フォーカス等）
   - 撮影モード切り替え（写真・動画・スローモーション）
   - 基本的なエラーハンドリング

4. **MultipeerConnectivity 実装**
   - デバイス検索・接続機能
   - Master/Remote 役割管理
   - 基本的なデータ送受信
   - 接続状態の可視化

5. **設定同期機能実装**
   - 撮影パラメータの抽出・送信
   - Remote での設定適用
   - リアルタイム同期の実現

6. **同時撮影機能実装**
   - トリガ信号の送受信
   - 遅延測定・補正
   - 同期精度の最適化

#### Phase 1 の成果物
- **単体カメラアプリとして完成**: Apple 標準カメラ風の UI・操作性
- **高品質な撮影機能**: 写真・動画・スローモーション対応
- **Master/Remote 機能**: デバイス間の設定同期・同time撮影
- **教育現場で使用可能**: 安定した動作と直感的な操作

### Phase 2: 機能拡張

#### 追加実装機能
1. **撮影メタデータの自動記録**
   - タイムスタンプ、カメラ設定の記録
   - EXIF データへの書き込み
   - 実験ラベルの付与

2. **撮影同期の遅延測定・診断ツール**
   - RTT 測定機能
   - 遅延統計の表示
   - 同期品質の可視化

3. **カメラ接続状態の可視化**
   - デバイス一覧表示
   - 電池残量、ストレージ残量表示
   - 接続品質インジケータ

4. **簡易実験テンプレート機能**
   - 実験種別に応じた設定プリセット
   - ワンタッチ設定適用
   - カスタムプリセット作成

#### Phase 2 の作業手順
1. メタデータ機能の実装
2. 診断ツールの開発
3. UI の拡張・改善
4. テンプレート機能の追加
5. 総合テスト・デバッグ

### Phase 3: 将来拡張

#### 検討機能
1. **外部ハードウェアトリガ（マイコン連携）**
   - BLE 経由でのマイコン通信
   - 物理トリガによる撮影開始
   - 高精度な同期制御

2. **リアルタイムプレビュー共有**
   - Master のプレビューを Remote に配信
   - 低遅延ストリーミング
   - 帯域最適化

3. **撮影後の自動解析プラグイン**
   - フレーム抽出・解析
   - 速度計測、トラッキング
   - Core Image / Vision の活用

---

## 開発環境・ツール

### 必要なソフトウェア
- **Xcode**: 15.0 以降（iOS 17 サポート）
- **Swift**: 5.9 以降
- **iOS Simulator**: iOS 17.0 以降

### 推奨開発デバイス
- **テスト用 iPhone**: iPhone 12 以降（iOS 17 対応）
- **テスト用 iPad**: iPad (第6世代) 以降（iOS 17 対応）
- **複数台での動作確認**: Master/Remote 機能のテスト

### 開発時の注意点
1. **API 利用可能性の確認**
   ```swift
   if #available(iOS 17.0, *) {
       // iOS 17 以降の機能
   }
   ```

2. **デバイス機能の確認**
   ```swift
   guard let device = AVCaptureDevice.default(for: .video) else { return }
   // デバイス固有機能の確認
   ```

3. **MultipeerConnectivity のデバッグ**
   - 実機での動作確認必須
   - シミュレータでは制限あり

---

## テスト・検証

### 機能テスト項目
1. **基本機能**
   - カメラ起動・撮影
   - 設定変更・保存
   - アプリの安定性

2. **通信機能**
   - デバイス検出・接続
   - 設定同期の精度
   - 接続の安定性

3. **同期精度**
   - シャッタータイミングの同期
   - 遅延測定・補正
   - 複数台での動作

4. **UI/UX**
   - 操作の直感性
   - エラー表示・回復
   - パフォーマンス

### 性能要件
- **同期遅延**: 50ms 以下（目標）
- **接続安定性**: 99% 以上
- **バッテリー効率**: 標準カメラアプリと同等

---

## リリース・配布

### 配布方法
- **TestFlight**: 内部テスト・ベータ配布
- **App Store**: 一般公開（将来的に）
- **Enterprise**: 教育機関向け配布

### リリース準備
1. 最終動作確認
2. App Store 審査ガイドライン準備
3. プライバシーポリシー作成
4. 使用方法ドキュメント整備

---

## 関連ドキュメント

このプロジェクトの詳細情報は以下のドキュメント群で管理しています：

- `README.md` - プロジェクト概要・目的
- `ToDo/出来そうな機能.md` - 機能候補一覧
- `ToDo/iOS_API_バージョン差異.md` - iOS バージョン別 API 対応状況

---

## 更新履歴

- 2025/10/13: 初版作成
- 各 Phase の作業手順と成果物を明確化
- iOS 17+ & SwiftUI ベースの方針決定